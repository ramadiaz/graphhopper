services:
  graphhopper:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: graphhopper
    ports:
      - "8989:8989"
    volumes:
      # Mount OSM data file (download from https://download.geofabrik.de/)
      # IMPORTANT: The file must exist on the host, otherwise Docker will create a directory
      # Download Indonesian map: wget https://download.geofabrik.de/asia/indonesia-latest.osm.pbf
      - ./indonesia-latest.osm.pbf:/app/indonesia-latest.osm.pbf:ro
      # Persist graph cache between container restarts
      - graph-cache:/app/graph-cache
      # Persist logs
      - logs:/app/logs
    environment:
      # Adjust based on available system RAM
      - JAVA_OPTS=-Xmx12g -Xms12g -XX:+UseG1GC
      - OSM_FILE=/app/indonesia-latest.osm.pbf
    restart: on-failure

volumes:
  graph-cache:
  logs:

