services:
  graphhopper:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: graphhopper
    ports:
      - "8989:8989"
    volumes:
      # Mount OSM data file (download from https://download.geofabrik.de/)
      # IMPORTANT: The file must exist on the host, otherwise Docker will create a directory
      # Download Indonesian map: wget https://download.geofabrik.de/asia/java-latest.osm.pbf
      - ./java-latest.osm.pbf:/app/java-latest.osm.pbf:ro
      # Persist graph cache between container restarts
      - graph-cache:/app/graph-cache
      # Persist logs
      - logs:/app/logs
    environment:
      # Memory settings optimized for MMAP_STORE (uses less RAM than RAM_STORE)
      # During import: needs ~8-10GB heap
      # After import: uses ~4-6GB heap (MMAP_STORE allows OS to manage memory/disk)
      # If using RAM_STORE instead, increase to -Xmx12g -Xms12g
      - JAVA_OPTS=-Xmx10g -Xms10g -XX:+UseG1GC
      - OSM_FILE=/app/java-latest.osm.pbf
    restart: on-failure

volumes:
  graph-cache:
  logs:

